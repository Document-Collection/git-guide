
# 子模块

参考:[7.11 Git 工具 - 子模块](https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97)

开发个人网站的过程中需要用到主题仓库,所以会在一个仓库的里面嵌套另一个仓库,如果直接将子仓库加入版本管理,很多文件无法进行版本化,所以想到了子模块的操作

## 创建子模块

使用`git submodule`命令添加子模块

    $ git submodule add git@github.com:zjZSTU/hexo-theme-next.git blogs/themes/next
    Cloning into 'blogs/themes/next'...
    remote: Enumerating objects: 1, done.
    remote: Counting objects: 100% (1/1), done.
    remote: Total 5402 (delta 0), reused 0 (delta 0), pack-reused 5401
    Receiving objects: 100% (5402/5402), 5.29 MiB | 1.03 MiB/s, done.
    Resolving deltas: 100% (3294/3294), done.
    Checking connectivity... done.

除了添加子仓库之外,还生成了一个配置文件`.gitmodules`

    $ git status 
    On branch dev
    Your branch is ahead of 'origin/dev' by 1 commit.
    (use "git push" to publish your local commits)
    Changes to be committed:
    (use "git reset HEAD <file>..." to unstage)

        new file:   .gitmodules
        new file:   blogs/themes/next

`.gitmodules`里面保存了子模块的地址和远程仓库链接

    $ cat .gitmodules 
    [submodule "blogs/themes/next"]
        path = blogs/themes/next
        url = git@github.com:zjZSTU/hexo-theme-next.git

## 管理子模块

主仓库只能提示子模块中的文件修改,必须子模块自己进行添加和上传

比如在`next`文件夹内新建文件`hellogit`

    # 对于主模块而言
    $ git status 
    On branch dev
    Your branch is up-to-date with 'origin/dev'.
    Changes not staged for commit:
        (use "git add <file>..." to update what will be committed)
        (use "git checkout -- <file>..." to discard changes in working directory)
        (commit or discard the untracked or modified content in submodules)

	    modified:   next (untracked content)

    no changes added to commit (use "git add" and/or "git commit -a")
    # 对于子模块而言
    $ git status 
    HEAD detached at 0c5ed6f
    Untracked files:
        (use "git add <file>..." to include in what will be committed)

	    hellogit

    nothing added to commit but untracked files present (use "git add" to track)

## 克隆子模块

克隆主仓库后子模块的文件夹在但是没有文件,还需要进一步克隆子仓库

    # 初始化本地配置文件
    $ git submodule init
    # 拉取远程仓库
    $ git submodule update

集成代码如下:

    $ git submodule update --init --recursive

## 更新子模块

如果子模块有更新,可以进入子模块路径进行更新

    $ git pull

或者在主仓库更新所有子模块

    $ git submodule foreach git pull 
